<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  xmlns:th="http://www.thymeleaf.org" >
<head lang="en">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400,700">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
</head>
<style>
    .shine {
        background: #f6f7f8;
        background-image: linear-gradient(to right, #f6f7f8 0%, #edeef1 20%, #f6f7f8 40%, #f6f7f8 100%);
        background-repeat: no-repeat;
        width: auto;
        display: inline-block;
        position: relative;

        -webkit-animation-duration: 1s;
        -webkit-animation-fill-mode: forwards;
        -webkit-animation-iteration-count: infinite;
        -webkit-animation-name: placeholderShimmer;
        -webkit-animation-timing-function: linear;
    }

    box {
        height: 104px;
        width: 100px;
    }



    lines {
        height: 10px;
        margin-top: 10px;
        width: 200px;
    }

    photo {
        display: block!important;
        width: 325px;
        height: 100px;
        margin-top: 15px;
    }

    @-webkit-keyframes placeholderShimmer {
        0% {
            background-position: -468px 0;
        }

        100% {
            background-position: 468px 0;
        }
    }
    @import url('https://fonts.googleapis.com/css2?family=Lato&display=swap');
</style>
<body>
<header th:insert="header.html ::  nav"></header>
<div class="container-fluid mt-5">
    <div class="col-lg-12">
        <div class="row">
            <div class="col-lg-2 "  >
                <div style="position: fixed; " th:insert="home/sidenav.html ::  sidenav"></div>
            </div>
            <div class="col-lg-10 ml-5" style="left: 12% ;" >
                <ul class="nav justify-content-center " style="background-color: #ffffff!important ;padding-top:10px;padding-bottom: 10px;box-shadow: 0 4px 8px 0 rgba(0,0,0,0.08);border-radius: 10px; ">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" style="color: #3b5998;font-weight: 500"  ><i class="fas fa-id-badge"></i> Profiles
                            <span class="badge badge-primary ml-1" th:text="${userProfiles}"></span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" style="color:orangered;font-weight: 500"><i class="fas fa-broadcast-tower"></i> Broadcast <span class="badge badge-danger ml-1">3</span> </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" style="color:green;font-weight: 500"><i class="fas fa-user-friends"></i> Online Users <span class="badge badge-success ml-1" id="online-users">
                        </span></a>
                    </li>
                </ul>
                <br><br>

                    <div class="row" style="float: left;">
                        <div class="users">

                        </div></div>
                <div class="ajax-loader">
                    <photo class="shine" id="shimmer-photo"></photo>
                    <photo class="shine" id="shimmer-photo"></photo>
                    <photo class="shine" id="shimmer-photo"></photo>
                    <photo class="shine" id="shimmer-photo"></photo>
                    <photo class="shine" id="shimmer-photo"></photo>
                </div>
            </div>
        </div>
    </div>
</div>


</body>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script>
    $(document).ready(function() {
        var poll = function () {
            jQuery.ajax({
                url: '/api/users/profile',
                dataType: 'json',
                type: 'get',
                async: false,
                beforeSend: function () {
                    $('.ajax-loader').css("visibility", "visible");
                    $('#shimmer-photo').show();
                },
                success: function (data) {
                    console.log("success");
                    $('#shimmer-photo').hide();
                    $('.ajax-loader').css("visibility", "hidden");
                    var obj = JSON.parse(JSON.stringify(data));
                    var responses = "";
                    for (var i = 0; i <= obj.length; i++) {
                        var result = `
                            <div class="row" style="float: left;">
                                <a href="/user/profile/`+obj[i].username + `"  class="custom-card" style="text-decoration: none; color: #313437;">
                                   <div class="card bg-light mb-3 mr-5  ml-5 mt-2 " style="max-width: 16rem;max-width: 16rem;box-shadow: 0 4px 8px 0 rgba(0,0,0,0.08);border-radius: 10px;overflow: hidden;text-decoration: none;">
                                      <img class="card-img-top image-thumbnail" height="200" width="150"  src="`+obj[i].profilePhoto +`"   alt="Card image cap">
                                         <div class="card-body" style="background-color: white">
                                             <h5 class="card-title " > `+obj[i].firstName +'  '+  obj[i].lastName + ' , '+   obj[i].aboutMe.age +`</h5>
                                                <p>`+obj[i].aboutMe.bio+`</p>
                                          </div>
                                    </div>
                                </a>
                            </div>

                         `;
                        responses += result;
                        $('.users').html(responses);
                    }
                },
                complete: function (data) {
                    $('.ajax-loader').css("visibility", "hidden");
                }
            });
        };
        setInterval(function () {
            poll();
        },3000);


        var myPage = 1;
        if ($(window).scrollTop() >= ($(document).height() - $(window).height())*0.7) {

        }

    });

</script>
<script>
    //count the online users
    setInterval(function () {
        $.ajax({
            url:'/api/count/users/online',
            method:'get',
            type: 'text',
            success:function (data) {
                $('#online-users').text(data);
            }
        });
    },10000);
    //count the online users
    setInterval(function () {
       jQuery.ajax({
            url: '/api/count/notification',
            method: 'get',
            type: 'text',
            success: function (data) {

                if(("#notification-number").val() === ''|| $("notification-number").val() === 0){
                    $('#notification-number').text('');
                }else {
                    $('#notification-number').text(data);
                }

            }, error: function (error) {
                console.log(error);
            }
        });
    }, 2000);


    $("#notification-button").click(function(){

        jQuery.ajax({
            url: '/api/count/notification',
            method: 'get',
            type: 'text',
            success: function (data) {
                $('#notification-number').text(data);

            }, error: function (error) {
                console.log(error);
            }
        });





    });
</script>

<script>

    //get all the notification
    jQuery.ajax({
        url: '/api/users/notifications/get',
        method: 'get',
        type: 'json',
        success: function (data) {
            var obj = JSON.parse(JSON.stringify(data));
            var responses = "";
            for (var i = 0; i <= obj.length; i++) {
               var result = ` <div class="container-fluid">
                                    <div class="col-md-12">
                                        <div class="row">
                                            <div class="col-md-0 ">
                                                <img height="60" th:src="@{/}" width="50" style=" border-radius: 50%;">
                                            </div>
                                            <div class="col-md-7">
                                                <div class="notification-head">
                                                    <h6 >` +data[i].message + `</h6>
                                                </div>
                                                <div class="notification-body">
                                                    <h6>`+data[i].datetime_added+`</h6>
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <form  action="/api/notification/delete/`+data[i].id +`" method="get">
                                                <button class="btn btn-default" type="submit"><i class="fa fa-remove" style="color: #313437"></i> </button>
                                                </form>
                                            </div>
                                        </div>
                                        <hr>
                                    </div>
                                </div>
                    `;
                responses += result;
                console.log(responses);
                $('#container-notification').html(responses);
            }
        }, error: function (error) {
            console.log(error);
        }
    });

    $('#notification-button').click(function () {
        $.ajax({
            url: '/api/users/notification/read',
            method:'post',
            success:function (data) {
                console.log("notification has been seen")
            }
        })
    })



</script>
<script src="https://kit.fontawesome.com/6f40d29aa1.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</html>